<!DOCTYPE html>
<html lang="th">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Firebase Device Management System</title>
<style>
  * {
    margin: 0;
    padding: 0;
    box-sizing: border-box;
  }

  body {
    font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
    background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
    min-height: 100vh;
    padding: 20px;
    position: relative;
    overflow-x: hidden;
  }

  /* Animated background particles */
  .particle {
    position: absolute;
    width: 4px;
    height: 4px;
    background: rgba(255, 255, 255, 0.3);
    border-radius: 50%;
    animation: float 6s ease-in-out infinite;
  }

  @keyframes float {
    0%, 100% { transform: translateY(0px) rotate(0deg); }
    50% { transform: translateY(-20px) rotate(180deg); }
  }

  .container {
    max-width: 1200px;
    margin: 0 auto;
    background: rgba(255, 255, 255, 0.95);
    backdrop-filter: blur(15px);
    border-radius: 25px;
    padding: 40px;
    box-shadow: 0 25px 50px rgba(0, 0, 0, 0.2);
    position: relative;
    border: 1px solid rgba(255, 255, 255, 0.2);
  }

  .container::before {
    content: '';
    position: absolute;
    top: -2px;
    left: -2px;
    right: -2px;
    bottom: -2px;
    background: linear-gradient(45deg, #667eea, #764ba2, #f093fb, #f5576c);
    border-radius: 25px;
    z-index: -1;
    animation: gradient-border 3s ease infinite;
  }

  @keyframes gradient-border {
    0%, 100% { background-position: 0% 50%; }
    50% { background-position: 100% 50%; }
  }

  /* Connection Status */
  .connection-status {
    position: fixed;
    top: 20px;
    right: 20px;
    padding: 10px 20px;
    border-radius: 20px;
    color: white;
    font-weight: bold;
    z-index: 1000;
    transition: all 0.3s ease;
    display: flex;
    align-items: center;
    gap: 8px;
  }

  .connection-status.connected {
    background: linear-gradient(45deg, #27ae60, #2ecc71);
    box-shadow: 0 4px 15px rgba(46, 204, 113, 0.3);
  }

  .connection-status.disconnected {
    background: linear-gradient(45deg, #e74c3c, #c0392b);
    box-shadow: 0 4px 15px rgba(231, 76, 60, 0.3);
  }

  .connection-status.connecting {
    background: linear-gradient(45deg, #f39c12, #e67e22);
    box-shadow: 0 4px 15px rgba(243, 156, 18, 0.3);
  }

  .status-dot {
    width: 10px;
    height: 10px;
    border-radius: 50%;
    background: white;
    animation: pulse 2s infinite;
  }

  @keyframes pulse {
    0% { transform: scale(1); opacity: 1; }
    50% { transform: scale(1.2); opacity: 0.7; }
    100% { transform: scale(1); opacity: 1; }
  }

  h1 {
    text-align: center;
    color: #2c3e50;
    font-size: 3em;
    margin-bottom: 40px;
    text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.1);
    background: linear-gradient(45deg, #667eea, #764ba2);
    -webkit-background-clip: text;
    -webkit-text-fill-color: transparent;
    background-clip: text;
    position: relative;
  }

  h1::after {
    content: '';
    position: absolute;
    bottom: -10px;
    left: 50%;
    transform: translateX(-50%);
    width: 100px;
    height: 4px;
    background: linear-gradient(45deg, #667eea, #764ba2);
    border-radius: 2px;
  }

  h2 {
    color: #34495e;
    font-size: 2em;
    margin: 40px 0 25px 0;
    padding: 15px 25px;
    background: linear-gradient(45deg, #3498db, #2980b9);
    color: white;
    border-radius: 15px;
    position: relative;
    box-shadow: 0 6px 20px rgba(52, 152, 219, 0.3);
    transform: translateX(-10px);
  }

  h2::before {
    content: '';
    position: absolute;
    left: -10px;
    top: 50%;
    transform: translateY(-50%);
    width: 0;
    height: 0;
    border-top: 15px solid transparent;
    border-bottom: 15px solid transparent;
    border-right: 10px solid #3498db;
  }

  h3 {
    color: #2c3e50;
    font-size: 1.5em;
    margin: 30px 0 20px 0;
    padding: 12px 25px;
    background: linear-gradient(45deg, #f39c12, #e67e22);
    color: white;
    border-radius: 25px;
    display: inline-block;
    box-shadow: 0 6px 20px rgba(243, 156, 18, 0.3);
    position: relative;
    overflow: hidden;
  }

  h3::before {
    content: '';
    position: absolute;
    top: 0;
    left: -100%;
    width: 100%;
    height: 100%;
    background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.2), transparent);
    transition: left 0.5s;
  }

  h3:hover::before {
    left: 100%;
  }

  .stats-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
    gap: 20px;
    margin-bottom: 30px;
  }

  .stat-card {
    background: linear-gradient(45deg, #667eea, #764ba2);
    color: white;
    padding: 25px;
    border-radius: 15px;
    text-align: center;
    box-shadow: 0 10px 30px rgba(0, 0, 0, 0.1);
    transition: all 0.3s ease;
    position: relative;
    overflow: hidden;
  }

  .stat-card::before {
    content: '';
    position: absolute;
    top: -50%;
    left: -50%;
    width: 200%;
    height: 200%;
    background: radial-gradient(circle, rgba(255, 255, 255, 0.1) 0%, transparent 70%);
    transition: transform 0.5s;
    transform: scale(0);
  }

  .stat-card:hover::before {
    transform: scale(1);
  }

  .stat-card:hover {
    transform: translateY(-5px);
    box-shadow: 0 15px 40px rgba(0, 0, 0, 0.2);
  }

  .stat-number {
    font-size: 2.5em;
    font-weight: bold;
    margin-bottom: 10px;
  }

  .stat-label {
    font-size: 1.1em;
    opacity: 0.9;
  }

  .table-container {
    overflow-x: auto;
    margin-bottom: 30px;
    border-radius: 20px;
    box-shadow: 0 15px 40px rgba(0, 0, 0, 0.1);
    background: white;
    border: 1px solid rgba(255, 255, 255, 0.2);
  }

  table {
    border-collapse: collapse;
    width: 100%;
    background: white;
    border-radius: 20px;
    overflow: hidden;
  }

  th {
    background: linear-gradient(45deg, #3498db, #2980b9);
    color: white;
    padding: 20px;
    text-align: left;
    font-weight: 600;
    text-transform: uppercase;
    letter-spacing: 1px;
    font-size: 0.9em;
    position: relative;
  }

  th::after {
    content: '';
    position: absolute;
    bottom: 0;
    left: 0;
    right: 0;
    height: 2px;
    background: linear-gradient(45deg, #2980b9, #3498db);
  }

  td {
    padding: 18px 20px;
    border-bottom: 1px solid #ecf0f1;
    transition: all 0.3s ease;
    position: relative;
  }

  tr:hover td {
    background: linear-gradient(45deg, #f8f9fa, #e9ecef);
    transform: scale(1.02);
    box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
  }

  tr:nth-child(even) {
    background: #f8f9fa;
  }

  .form-container {
    background: white;
    padding: 35px;
    border-radius: 20px;
    box-shadow: 0 15px 40px rgba(0, 0, 0, 0.1);
    margin-bottom: 30px;
    border: 2px solid transparent;
    transition: all 0.3s ease;
    position: relative;
    overflow: hidden;
  }

  .form-container::before {
    content: '';
    position: absolute;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    background: linear-gradient(45deg, #667eea, #764ba2);
    opacity: 0;
    transition: opacity 0.3s ease;
    z-index: -1;
  }

  .form-container:hover::before {
    opacity: 0.05;
  }

  .form-container:hover {
    border-color: #3498db;
    transform: translateY(-5px);
    box-shadow: 0 20px 50px rgba(0, 0, 0, 0.15);
  }

  .form-group {
    margin-bottom: 25px;
    position: relative;
  }

  label {
    display: block;
    margin-bottom: 10px;
    font-weight: 600;
    color: #2c3e50;
    font-size: 1.1em;
    transition: color 0.3s ease;
  }

  input[type="text"], input[type="number"], input[type="date"] {
    width: 100%;
    padding: 15px 20px;
    border: 2px solid #ecf0f1;
    border-radius: 12px;
    font-size: 1.1em;
    transition: all 0.3s ease;
    background: #f8f9fa;
    position: relative;
  }

  input[type="text"]:focus, input[type="number"]:focus, input[type="date"]:focus {
    outline: none;
    border-color: #3498db;
    background: white;
    box-shadow: 0 0 0 4px rgba(52, 152, 219, 0.1);
    transform: translateY(-2px);
  }

  input:disabled {
    background: #ecf0f1;
    cursor: not-allowed;
    opacity: 0.7;
  }

  .button-group {
    display: flex;
    gap: 15px;
    flex-wrap: wrap;
    margin-top: 30px;
  }

  button {
    padding: 15px 30px;
    border: none;
    border-radius: 30px;
    font-size: 1em;
    font-weight: 600;
    cursor: pointer;
    transition: all 0.3s ease;
    text-transform: uppercase;
    letter-spacing: 1px;
    box-shadow: 0 6px 20px rgba(0, 0, 0, 0.1);
    position: relative;
    overflow: hidden;
  }

  button::before {
    content: '';
    position: absolute;
    top: 50%;
    left: 50%;
    width: 0;
    height: 0;
    background: rgba(255, 255, 255, 0.2);
    border-radius: 50%;
    transition: all 0.3s ease;
    transform: translate(-50%, -50%);
  }

  button:hover::before {
    width: 300px;
    height: 300px;
  }

  button[type="submit"] {
    background: linear-gradient(45deg, #27ae60, #2ecc71);
    color: white;
  }

  button[type="submit"]:hover {
    background: linear-gradient(45deg, #2ecc71, #27ae60);
    transform: translateY(-3px);
    box-shadow: 0 10px 30px rgba(46, 204, 113, 0.3);
  }

  .cancel-btn {
    background: linear-gradient(45deg, #95a5a6, #7f8c8d);
    color: white;
  }

  .cancel-btn:hover {
    background: linear-gradient(45deg, #7f8c8d, #95a5a6);
    transform: translateY(-3px);
    box-shadow: 0 10px 30px rgba(127, 140, 141, 0.3);
  }

  .edit-btn {
    background: linear-gradient(45deg, #f39c12, #e67e22);
    color: white;
    padding: 10px 20px;
    font-size: 0.85em;
  }

  .edit-btn:hover {
    background: linear-gradient(45deg, #e67e22, #f39c12);
    transform: translateY(-2px);
    box-shadow: 0 8px 25px rgba(243, 156, 18, 0.3);
  }

  .delete-btn {
    background: linear-gradient(45deg, #e74c3c, #c0392b);
    color: white;
    padding: 10px 20px;
    font-size: 0.85em;
  }

  .delete-btn:hover {
    background: linear-gradient(45deg, #c0392b, #e74c3c);
    transform: translateY(-2px);
    box-shadow: 0 8px 25px rgba(231, 76, 60, 0.3);
  }

  .divider {
    height: 4px;
    background: linear-gradient(45deg, #3498db, #e74c3c, #f39c12, #27ae60);
    margin: 50px 0;
    border-radius: 2px;
    box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
    position: relative;
  }

  .divider::before {
    content: '';
    position: absolute;
    top: -2px;
    left: 0;
    right: 0;
    height: 8px;
    background: linear-gradient(45deg, #3498db, #e74c3c, #f39c12, #27ae60);
    border-radius: 4px;
    opacity: 0.3;
    filter: blur(4px);
  }

  .section {
    margin-bottom: 60px;
  }

  /* Loading spinner */
  .loading {
    text-align: center;
    padding: 40px;
    color: #7f8c8d;
    font-style: italic;
    font-size: 1.2em;
  }

  .spinner {
    width: 40px;
    height: 40px;
    border: 4px solid #ecf0f1;
    border-top: 4px solid #3498db;
    border-radius: 50%;
    animation: spin 1s linear infinite;
    margin: 0 auto 20px;
  }

  @keyframes spin {
    0% { transform: rotate(0deg); }
    100% { transform: rotate(360deg); }
  }

  /* Success message */
  .success-message {
    background: linear-gradient(45deg, #27ae60, #2ecc71);
    color: white;
    padding: 15px 25px;
    border-radius: 12px;
    margin-bottom: 25px;
    text-align: center;
    display: none;
    font-weight: bold;
    box-shadow: 0 6px 20px rgba(46, 204, 113, 0.3);
  }

  /* Enhanced table cell styling */
  .device-id {
    font-weight: bold;
    color: #2c3e50;
    font-family: 'Courier New', monospace;
    background: linear-gradient(45deg, #ecf0f1, #d5dbdb);
    padding: 8px 12px;
    border-radius: 8px;
    display: inline-block;
  }

  .temperature {
    color: #e74c3c;
    font-weight: bold;
    font-size: 1.1em;
  }

  .humidity {
    color: #3498db;
    font-weight: bold;
    font-size: 1.1em;
  }

  .location {
    color: #27ae60;
    font-style: italic;
    font-weight: 500;
  }

  .mac-address {
    font-family: 'Courier New', monospace;
    color: #7f8c8d;
    font-size: 0.9em;
    background: #f8f9fa;
    padding: 4px 8px;
    border-radius: 4px;
    display: inline-block;
  }

  /* Responsive Design */
  @media (max-width: 768px) {
    .container {
      padding: 25px;
      margin: 10px;
    }
   
    h1 {
      font-size: 2.2em;
    }
   
    h2 {
      font-size: 1.6em;
    }
   
    .stats-grid {
      grid-template-columns: 1fr;
    }
   
    table {
      font-size: 0.9em;
    }
   
    .button-group {
      flex-direction: column;
    }
   
    button {
      width: 100%;
    }
  }

  /* Animations */
  @keyframes fadeInUp {
    from {
      opacity: 0;
      transform: translateY(30px);
    }
    to {
      opacity: 1;
      transform: translateY(0);
    }
  }

  .container {
    animation: fadeInUp 0.8s ease-out;
  }

  .table-container {
    animation: fadeInUp 1s ease-out;
  }

  .form-container {
    animation: fadeInUp 1.2s ease-out;
  }
</style>
</head>
<body>

<!-- Animated background particles -->
<div class="particles-container"></div>

<!-- Connection Status -->
<div id="connectionStatus" class="connection-status connecting">
  <div class="status-dot"></div>
  <span id="statusText">กำลังเชื่อมต่อ Firebase...</span>
</div>

<div class="container">
  <h1>🌡️ Firebase Device Management System</h1>

  <!-- Stats Grid -->
  <div class="stats-grid">
    <div class="stat-card">
      <div class="stat-number" id="totalDevices">0</div>
      <div class="stat-label">📱 จำนวนอุปกรณ์</div>
    </div>
    <div class="stat-card">
      <div class="stat-number" id="totalReadings">0</div>
      <div class="stat-label">📊 จำนวนการอ่านค่า</div>
    </div>
    <div class="stat-card">
      <div class="stat-number" id="avgTemperature">0°C</div>
      <div class="stat-label">🌡️ อุณหภูมิเฉลี่ย</div>
    </div>
    <div class="stat-card">
      <div class="stat-number" id="avgHumidity">0%</div>
      <div class="stat-label">💧 ความชื้นเฉลี่ย</div>
    </div>
  </div>

  <div class="section">
    <h2>📱 ตารางอุปกรณ์</h2>
    <div class="table-container">
      <table id="deviceTable">
        <thead>
          <tr>
            <th>รหัสอุปกรณ์</th>
            <th>ชื่ออุปกรณ์</th>
            <th>ตำแหน่ง</th>
            <th>MAC Address</th>
            <th>วันที่เริ่มใช้งาน</th>
            <th>การดำเนินการ</th>
          </tr>
        </thead>
        <tbody>
          <tr>
            <td colspan="6" class="loading">
              <div class="spinner"></div>
              กำลังโหลดข้อมูลอุปกรณ์...
            </td>
          </tr>
        </tbody>
      </table>
    </div>

    <h3>➕ เพิ่ม / แก้ไข อุปกรณ์</h3>
    <div class="form-container">
      <div class="success-message" id="deviceSuccessMessage">
        บันทึกข้อมูลอุปกรณ์เรียบร้อยแล้ว! ✅
      </div>
      <form id="deviceForm">
        <div class="form-group">
          <label>🔢 รหัสอุปกรณ์:</label>
          <input type="text" id="deviceId" required placeholder="กรอกรหัสอุปกรณ์">
        </div>
        <div class="form-group">
          <label>📝 ชื่ออุปกรณ์:</label>
          <input type="text" id="deviceName" required placeholder="กรอกชื่ออุปกรณ์">
        </div>
        <div class="form-group">
          <label>📍 ตำแหน่ง:</label>
          <input type="text" id="deviceLocation" required placeholder="กรอกตำแหน่งติดตั้ง">
        </div>
        <div class="form-group">
          <label>🔗 MAC Address:</label>
          <input type="text" id="deviceMac" required placeholder="AA:BB:CC:DD:EE:FF">
        </div>
        <div class="form-group">
          <label>📅 วันที่เริ่มใช้งาน:</label>
          <input type="date" id="deviceStartDate" required>
        </div>
        <div class="button-group">
          <button type="submit">💾 บันทึกข้อมูล</button>
          <button type="button" id="deviceFormCancel" class="cancel-btn">❌ ยกเลิก</button>
        </div>
      </form>
    </div>
  </div>

  <div class="divider"></div>

  <div class="section">
    <h2>📊 ตารางการอ่านค่า</h2>
    <div class="table-container">
      <table id="readingsTable">
        <thead>
          <tr>
            <th>รหัสอุปกรณ์</th>
            <th>อุณหภูมิ (°C)</th>
            <th>ความชื้น (%)</th>
            <th>เวลาอัพเดต</th>
            <th>การดำเนินการ</th>
          </tr>
        </thead>
        <tbody>
          <tr>
            <td colspan="5" class="loading">
              <div class="spinner"></div>
              กำลังโหลดข้อมูลการอ่านค่า...
            </td>
          </tr>
        </tbody>
      </table>
    </div>

    <h3>➕ เพิ่ม / แก้ไข การอ่านค่า</h3>
    <div class="form-container">
      <div class="success-message" id="readingSuccessMessage">
        บันทึกข้อมูลการอ่านค่าเรียบร้อยแล้ว! ✅
      </div>
      <form id="readingForm">
        <div class="form-group">
          <label>🔢 รหัสอุปกรณ์:</label>
          <input type="text" id="readingDeviceId" required placeholder="กรอกรหัสอุปกรณ์">
        </div>
        <div class="form-group">
          <label>🌡️ อุณหภูมิ (°C):</label>
          <input type="number" step="0.1" id="readingTemp" required placeholder="0.0">
        </div>
        <div class="form-group">
          <label>💧 ความชื้น (%):</label>
          <input type="number" step="0.1" id="readingHumidity" required placeholder="0.0">
        </div>
        <div class="button-group">
          <button type="submit">💾 บันทึกข้อมูล</button>
          <button type="button" id="readingFormCancel" class="cancel-btn">❌ ยกเลิก</button>
        </div>
      </form>
    </div>
  </div>
</div>

<!-- Firebase SDK -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/firebase/9.22.1/firebase-app-compat.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/firebase/9.22.1/firebase-database-compat.min.js"></script>

<script>
  // Firebase Configuration
  const firebaseConfig = {
    apiKey: "AIzaSyDEYfPubp3VGlRHPgo77jmJ-i1ZECjjY3E",
    authDomain: "iaiot-c3798.firebaseapp.com",
    projectId: "iaiot-c3798",
    storageBucket: "iaiot-c3798.firebasestorage.app",
    messagingSenderId: "186105807007",
    appId: "1:186105807007:web:ffe96f6b52d35dcf3ce2aa",
    measurementId: "G-1HW0SE7G94",
    databaseURL: "https://iaiot-c3798-default-rtdb.asia-southeast1.firebasedatabase.app"
  };

  // Initialize Firebase
  firebase.initializeApp(firebaseConfig);
  const database = firebase.database();

  // Connection Status
  const connectionStatus = document.getElementById('connectionStatus');
  const statusText = document.getElementById('statusText');

  // Check connection status
  const connectedRef = database.ref('.info/connected');
  connectedRef.on('value', (snapshot) => {
    if (snapshot.val() === true) {
      connectionStatus.className = 'connection-status connected';
      statusText.textContent = 'เชื่อมต่อ Firebase สำเร็จ';
    } else {
      connectionStatus.className = 'connection-status disconnected';
      statusText.textContent = 'การเชื่อมต่อ Firebase ขัดข้อง';
    }
  });

  // Data storage
  let devices = {};
  let readings = {};

  // DOM Elements
  const deviceTableBody = document.querySelector('#deviceTable tbody');
  const readingTableBody = document.querySelector('#readingsTable tbody');
  const totalDevicesEl = document.getElementById('totalDevices');
  const totalReadingsEl = document.getElementById('totalReadings');
  const avgTemperatureEl = document.getElementById('avgTemperature');
  const avgHumidityEl = document.getElementById('avgHumidity');

  // Create animated particles
  function createParticles() {
    const particlesContainer = document.querySelector('.particles-container');
    for (let i = 0; i < 50; i++) {
      const particle = document.createElement('div');
      particle.className = 'particle';
      particle.style.left = Math.random() * 100 + '%';
      particle.style.top = Math.random() * 100 + '%';
      particle.style.animationDelay = Math.random() * 6 + 's';
      particlesContainer.appendChild(particle);
    }
  }

  // Update statistics
  function updateStatistics() {
    const deviceCount = Object.keys(devices).length;
    const readingCount = Object.keys(readings).length;
    
    totalDevicesEl.textContent = deviceCount;
    totalReadingsEl.textContent = readingCount;

    if (readingCount > 0) {
      const temperatures = Object.values(readings).map(r